{% extends 'base.html' %}
{% load static %}
{% block title %}{{ pokemon.name }}{% endblock %}

{% block content %}

    <link rel="stylesheet" href="{% static 'pokemon_detail.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <h1>{{ pokemon.name }}</h1>

    <div class="type-container">
        {% for pokemon_type in pokemon.types.all %}
            <img src="{{ pokemon_type.type.named_icon.url }}" alt="{{ pokemon_type.type.name }}" title="{{ pokemon_type.type.name }}" width="100">
        {% endfor %}
    </div>

    <p>Generación: {{ pokemon.generation }}</p>

    <div class="pokemon-images">
        <img src="{{ pokemon.sprite_default }}" alt="sprite {{ pokemon.name }}">
        <img src="{{ pokemon.sprite_shiny }}" alt="sprite {{ pokemon.name }} shiny">
        <img src="{{ pokemon.official_artwork_default }}" alt="{{ pokemon.name }}">
        <img src="{{ pokemon.official_artwork_shiny }}" alt="{{ pokemon.name }} shiny">
    </div>

    <div class="pokemon-description">
        <p>{{ pokemon.description }}</p>
    </div>

    <h2>Línea evolutiva completa</h2>

    <div class="evolution-line">
        {% if preevolutions %}
            <div class="evolution-block">
                <h3>Preevoluciona de</h3>
                {% for pre in preevolutions %}
                    <a href="{% url 'pokemon:pokemon_detail' pre.pokemon.id %}" class="evolution-card">
                        <img src="{{ pre.pokemon.official_artwork_default }}" alt="{{ pre.pokemon.name }}">
                        <span>{{ pre.pokemon.name }}</span>
                        <p class="evolution-condition">
                            {% if pre.trigger %}{{ pre.trigger }}{% endif %}
                            {% if pre.level %} (Nivel {{ pre.level }}){% endif %}
                            {% if pre.item %} (Objeto: {{ pre.item }}){% endif %}
                        </p>
                    </a>
                {% endfor %}
            </div>
        {% endif %}

        <div class="evolution-current">
            <h3>Actual</h3>
            <div class="evolution-card current">
                <img src="{{ pokemon.official_artwork_default }}" alt="{{ pokemon.name }}">
                <span>{{ pokemon.name }}</span>
            </div>
        </div>

        {% if evolutions %}
            <div class="evolution-block">
                <h3>Evoluciona a</h3>
                {% for evo in evolutions %}
                    <a href="{% url 'pokemon:pokemon_detail' evo.pokemon.id %}" class="evolution-card">
                        <img src="{{ evo.pokemon.official_artwork_default }}" alt="{{ evo.pokemon.name }}">
                        <span>{{ evo.pokemon.name }}</span>
                        <p class="evolution-condition">
                            {% if evo.trigger %}{{ evo.trigger }}{% endif %}
                            {% if evo.level %} (Nivel {{ evo.level }}){% endif %}
                            {% if evo.item %} (Objeto: {{ evo.item }}){% endif %}
                        </p>
                    </a>
                {% endfor %}
            </div>
        {% endif %}
    </div>

    <h2>Stats base</h2>
    <table class="stats-table">
        <thead>
            <tr>
                <th>Nombre estadística</th>
                <th colspan="2">Valor estadística base</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td class="stat-name">PS</td>
                <td class="stat-value">{{ pokemon.hp }}</td>
                <td>
                    <div class="progress" role="progressbar" aria-label="Basic example" aria-valuenow="{{ pokemon.hp }}" aria-valuemin="0" aria-valuemax="255">
                        <div class="progress-bar" style="width: calc({{ pokemon.hp }} / 255 * 100%); background-color: var(--pokemon-green)"></div>
                    </div>
                </td>
            </tr>
            <tr>
                <td class="stat-name">Ataque</td>
                <td class="stat-value">{{ pokemon.attack }}</td>
                <td>
                    <div class="progress" role="progressbar" aria-label="Basic example" aria-valuenow="{{ pokemon.attack }}" aria-valuemin="0" aria-valuemax="255">
                        <div class="progress-bar" style="width: calc({{ pokemon.attack }} / 255 * 100%); background-color: var(--pokemon-red)"></div>
                    </div>
                </td>
            </tr>
            <tr>
                <td class="stat-name">Defensa</td>
                <td class="stat-value">{{ pokemon.defense }}</td>
                <td>
                    <div class="progress" role="progressbar" aria-label="Basic example" aria-valuenow="{{ pokemon.defense }}" aria-valuemin="0" aria-valuemax="255">
                        <div class="progress-bar" style="width: calc({{ pokemon.defense }} / 255 * 100%); background-color: var(--pokemon-blue)"></div>
                    </div>
                </td>
            </tr>
            <tr>
                <td class="stat-name">Ataque Especial</td>
                <td class="stat-value">{{ pokemon.special_attack }}</td>
                <td>
                    <div class="progress" role="progressbar" aria-label="Basic example" aria-valuenow="{{ pokemon.special_attack }}" aria-valuemin="0" aria-valuemax="255">
                        <div class="progress-bar" style="width: calc({{ pokemon.special_attack }} / 255 * 100%); background-color: var(--pokemon-purple)"></div>
                    </div>
                </td>
            </tr>
            <tr>
                <td class="stat-name">Defensa Especial</td>
                <td class="stat-value">{{ pokemon.special_defense }}</td>
                <td>
                    <div class="progress" role="progressbar" aria-label="Basic example" aria-valuenow="{{ pokemon.special_defense }}" aria-valuemin="0" aria-valuemax="255">
                        <div class="progress-bar" style="width: calc({{ pokemon.special_defense }} / 255 * 100%); background-color: var(--pokemon-dark-blue)"></div>
                    </div>
                </td>
            </tr>
            <tr>
                <td class="stat-name">Velocidad</td>
                <td class="stat-value">{{ pokemon.speed }}</td>
                <td>
                    <div class="progress" role="progressbar" aria-label="Basic example" aria-valuenow="{{ pokemon.speed }}" aria-valuemin="0" aria-valuemax="255">
                        <div class="progress-bar" style="width: calc({{ pokemon.speed }} / 255 * 100%); background-color: var(--pokemon-yellow)"></div>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>

    <div class="abilities-section">
        <h2>Habilidades</h2>
        {% for p_ability in pokemon.abilities.all %}
            <div class="ability{% if p_ability.is_hidden %} hidden{% endif %}">
                <h3>{% if p_ability.is_hidden %}Oculta{% else %}Normal{% endif %}</h3>
                <p>{{ p_ability.ability.name }}</p>
            </div>
        {% endfor %}
    </div>

    <p>Altura: {{ pokemon.height }} | Peso: {{ pokemon.weight }}</p>
    <a href="{% url 'pokemon:home_page' %}" class="back-link">Volver</a>
{% endblock %}